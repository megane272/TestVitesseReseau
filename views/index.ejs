<%- include('commons/header.ejs') %>
    <h1>Network Speed Test</h1>
<button id="startTest">Run Test</button>
<div id="progress" style="margin: 20px 0;"></div>
<div id="results" style="font-family: monospace;"></div>

<p><a href="/about">A propos</a> | <a href="/contact">Contact</a></p>
<script>
  const startBtn = document.getElementById('startTest');
  const progressDiv = document.getElementById('progress');
  const resultsDiv = document.getElementById('results');

  startBtn.addEventListener('click', async () => {
    startBtn.disabled = true;
    progressDiv.innerHTML = `<p>Running speed test...</p>`;
    resultsDiv.innerHTML = ''; 
    
    try {
      const response = await fetch('/api/test-speed');

      if (!response.ok){
        throw new Error(`HTTP Error: ${response.status}`);
      }

      const data = await response.json();

      resultsDiv.innerHTML = `
        <h3>Test Results : </h3>
        <p><strong>Ping:</strong> ${data.ping}</p>
        <p><strong>Download:</strong> ${data.download}</p>
        <p><strong>Upload:</strong> ${data.upload}</p>
        <p><em>Test run at ${new Date(data.timestamp).toLocaleDateString()}</em></p>
        `;
    } catch (error) {
      resultsDiv.innerHTML = `
        <p style="color: red;"><strong>Error:</strong>${error.message}</p>
        <p>${error.solution || 'Please try again later.'}</p>`;
    } finally {
        startBtn.disabled = false;
    }
    });
</script>

<%- include ('commons/footer.ejs') %>
